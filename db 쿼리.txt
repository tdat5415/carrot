CREATE TABLE BOARD_LIKES(
	like_idx BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
	like_user_idx BIGINT UNSIGNED NOT NULL,
	like_board_idx BIGINT UNSIGNED NOT NULL,
	like_datetime TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
	ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(like_idx),
	UNIQUE(like_idx),
	UNIQUE(like_user_idx, like_board_idx),
	FOREIGN KEY(like_user_idx) REFERENCES USERS(user_idx)
	ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY(like_board_idx) REFERENCES BOARDS(board_idx)
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE BOARD_CATEGORY(
	category_idx BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
	category_name VARCHAR(30) NOT NULL,
	PRIMARY KEY(category_idx),
	UNIQUE(category_idx)
);

ALTER TABLE BOARDS ADD board_category_idx BIGINT UNSIGNED;

SET FOREIGN_KEY_CHECKS = 0;
ALTER TABLE BOARDS ADD FOREIGN KEY(board_category_idx) REFERENCES BOARD_CATEGORY(category_idx)
ON UPDATE CASCADE ON DELETE SET NULL;
SET FOREIGN_KEY_CHECKS = 1;

ALTER TABLE USERS MODIFY user_delete_flag BOOLEAN NOT NULL DEFAULT false;
ALTER TABLE BOARDS MODIFY board_delete_flag BOOLEAN NOT NULL DEFAULT false;
ALTER TABLE BOARDS MODIFY board_like_num INT UNSIGNED NOT NULL DEFAULT 0;
ALTER TABLE BOARDS MODIFY board_view_num INT UNSIGNED NOT NULL DEFAULT 0;
ALTER TABLE BOARD_IMAGES MODIFY image_delete_flag BOOLEAN NOT NULL DEFAULT false;
ALTER TABLE COMMENT MODIFY comment_delete_flag BOOLEAN NOT NULL DEFAULT false;
ALTER TABLE CHAT MODIFY chat_delete_flag BOOLEAN NOT NULL DEFAULT false;

UPDATE USERS SET user_delete_flag=0;
UPDATE BOARDS SET board_delete_flag=0;
UPDATE BOARD_IMAGES SET image_delete_flag=0;
UPDATE COMMENT SET comment_delete_flag=0;
UPDATE CHAT SET chat_delete_flag=0;

USERS, BOARDS, BOARD_IMAGES, CHAT, COMMENT
